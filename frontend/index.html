<!DOCTYPE html>
<html>

<head>
  <title>Help Forum</title>

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <h1>Help Forum</h1>
    <div class="row">
      <div class="card card--question">
        <div class="form-group">
          <label for="askquestion">Subject</label>
          <input type="text" id="askquestion" name="askquestion" placeholder="Question Subject"
            oninput="onQuestionInputChange()" />
        </div>
        <div class="form-group">
          <label for="question-body">Body</label>
          <textarea type="text" id="question-body" name="question-body" placeholder="Question Body"></textarea>
        </div>
      </div>
      <div class="card card--suggestions" id="suggestions"></div>
    </div>

    <script>
      function onSuggestionClick(suggestionId) {
        console.log(suggestionId);
      }

      let fetchSuggestionsTimeout = null;

      async function fetchSuggestions() {
        const questionSubject =
          document.getElementById("askquestion").value || "Help";

        const res = await fetch(`/api/question/${questionSubject}`);

        if (!res.ok) {
          return;
        }

        const data = await res.json();

        const matches = data.matches;

        suggestionCardElement =
          document.getElementById("suggestions");

        suggestionCardElement.innerHTML = "";

        const num = 10;
        for (let i = 0; i < num; i++) {
          let suggestionElement = document.createElement("div");
          suggestionElement.innerHTML = matches[i].question;
          suggestionElement.classList.add("suggestion");
          suggestionElement.onclick = () => onSuggestionClick(i);

          suggestionCardElement.appendChild(suggestionElement);
        }
      }

      function onQuestionInputChange() {
        if (fetchSuggestionsTimeout) {
          clearTimeout(fetchSuggestionsTimeout);
        }

        fetchSuggestionsTimeout = setTimeout(fetchSuggestions, 190);
      }

      fetchSuggestions();
    </script>
  </div>
</body>

</html>